<view class="container">
  <view wx:if="{{loading}}" class="loading">
    <text>加载中...</text>
  </view>

  <view wx:else class="form">
    <!-- 商品搜索选择 -->
    <view class="form-item">
      <text class="form-label">选择商品 *</text>
      <view class="search-picker-container">
        <view class="search-input-wrapper">
          <input 
            class="search-input" 
            placeholder="搜索商品..." 
            value="{{productSearchKey}}" 
            bindinput="onProductSearchInput" 
          />
        </view>
        <view 
          class="selected-item" 
          wx:if="{{selectedProduct}}"
        >
          <text class="selected-text">{{selectedProduct.name}}</text>
          <text class="clear-btn" bindtap="clearSelectedProduct">×</text>
        </view>
        <view 
          class="selected-item placeholder" 
          wx:else
          bindtap="toggleProductList"
        >
          <text>请选择商品</text>
        </view>
        
        <!-- 商品列表 -->
        <view class="search-results" wx:if="{{showProductList}}">
          <scroll-view scroll-y="true" style="max-height: 400rpx;">
            <view 
              class="result-item" 
              wx:for="{{filteredProducts}}" 
              wx:key="id"
              bindtap="selectProduct"
              data-product="{{item}}"
            >
              <text class="result-name">{{item.name}}</text>
              <text class="result-code">{{item.code}}</text>
            </view>
            <view class="result-item empty" wx:if="{{filteredProducts.length === 0}}">
              <text>暂无商品</text>
            </view>
          </scroll-view>
        </view>
      </view>
    </view>

    <!-- 供应商信息（自动显示，不可编辑） -->
    <view class="form-item" wx:if="{{selectedProduct}}">
      <text class="form-label">供应商</text>
      <view class="form-input" style="background-color: #f5f5f5; color: #666;">
        {{selectedProduct.supplier ? selectedProduct.supplier.name : '未设置供应商'}}
      </view>
    </view>

    <view class="form-item">
      <text class="form-label">入库数量(斤) *</text>
      <input class="form-input" type="digit" value="{{quantity}}" bindinput="onQuantityChange" placeholder="请输入入库数量(斤)" />
    </view>

    <view class="form-actions">
      <button class="submit-btn" loading="{{submitLoading}}" bindtap="submit">确认入库</button>
    </view>
  </view>
</view>
